{"version":3,"file":"../mapbox.js","sources":["mapbox.js"],"sourcesContent":["\"use strict\";\n/// <reference types=\"jquery\" />\n/// <reference types=\"geojson\" />\n/// <reference types=\"mapbox-gl\" />\n/// <reference path=\"../types/mapbox-gl/index.d.ts\" />\n/// <reference path=\"../types/jquery/index.d.ts\"/>\n/// <reference path=\"./browser.d.ts\"/>\n/// <reference path=\"./util.ts\"/>\n$(function () {\n    var MAX_ZOOM = 18;\n    /**\n     * Number of decimals to round coordinates to.\n     */\n    var COORD_DECIMALS = 5;\n    /**\n     * Maximum number of photos to display in carousel.\n     */\n    var MAX_IN_CAROUSEL = 20;\n    /**\n     * Initial map position if not specified in URL\n     */\n    var initial = { zoom: 6.5, center: [-116.0987, 44.7] };\n    var style = {\n        font: ['Open Sans Bold', 'Arial Unicode MS Bold'],\n        minZoom: 6,\n        maxZoom: 18\n    };\n    var $count = $('#photo-count');\n    var $preview = $('#photo-preview');\n    var $zoomOut = $('nav .zoom-out');\n    var $legendToggle = $('#legend .toggle');\n    var slug = post ? '/' + post.key : '';\n    var qs = parseUrl();\n    /**\n     * @see https://www.mapbox.com/mapbox-gl-js/api/#navigationcontrol\n     */\n    var nav = new mapboxgl.NavigationControl();\n    /** https://www.mapbox.com/mapbox-gl-js/api/ */\n    var map = new mapboxgl.Map({\n        container: 'map-canvas',\n        style: 'mapbox://styles/' + mapStyle,\n        center: qs.center || initial.center,\n        zoom: qs.zoom || initial.zoom,\n        maxZoom: MAX_ZOOM,\n        dragRotate: false,\n        // https://github.com/mapbox/mapbox-gl-js/issues/3371\n        //touchZoomRotate: false,\n        keyboard: false\n    });\n    var canvas = map.getCanvasContainer();\n    var markerOpacity = 0.6;\n    var mapSize = { width: 0, height: 0 };\n    var previewSize = { width: 322, height: 350 };\n    /**\n     * Whether styling for mobile device. Should match CSS media queries in\n     * `settings.less` and `breakAt` in `responsive.ts`.\n     */\n    var mobileLayout = function (width) {\n        if (width === void 0) { width = 1024; }\n        return window.innerWidth <= width;\n    };\n    /**\n     * Whether zoom-out button is enabled\n     */\n    var zoomOutEnabled = false;\n    /**\n     * CSS media query hides legend for mobile. Browser setting will also be\n     * checkbed below to see if user hid legend.\n     */\n    var legendVisible = !mobileLayout();\n    var photosVisible = true;\n    /**\n     * Analytics: only track first use of photo navigation.\n     */\n    var navigatedPhoto = false;\n    /**\n     * Don't update URL with map position until after automatic movements.\n     */\n    var showPositionInUrl = false;\n    /**\n     * Cache GeoJSON photos so it can be reassigned if map style changes\n     */\n    var geoJSON = null;\n    /**\n     * Methods for generating map content\n     */\n    var html = {\n        /**\n         * Format coordinates.\n         */\n        coordinate: function (pos) {\n            var factor = Math.pow(10, COORD_DECIMALS);\n            var round = function (n) {\n                return Math.round(n * factor) / factor;\n            };\n            return round(pos[1]) + ', ' + round(pos[0]);\n        },\n        /**\n         * Make photo HTML.\n         */\n        photo: function (f) {\n            var img = f.properties;\n            if (img.url === undefined) {\n                return null;\n            }\n            var tip = 'Click or tap to enlarge';\n            return $('<figure>')\n                .append($('<img>')\n                .attr('src', img.url)\n                .attr('title', tip)\n                .attr('alt', tip)\n                .click(function () {\n                showPhotoInPost(img.url);\n            }))\n                .append($('<figcaption>').html(this.coordinate(f.geometry.coordinates)));\n        },\n        /**\n         * Show photo preview.\n         */\n        photoPreview: function (e, cssClass, content, navigation) {\n            $preview\n                .empty()\n                .removeClass()\n                .css(getPreviewPosition(e));\n            if (navigation !== undefined) {\n                $preview.append(navigation);\n            }\n            $preview\n                .addClass(cssClass)\n                .append(content)\n                .append(util.html.icon('close', handle.closePreview))\n                .show({ complete: handle.previewShown });\n        }\n    };\n    /**\n     * Event handlers\n     */\n    var handle = {\n        zoomEnd: function () {\n            updateUrl();\n            enableZoomOut();\n        },\n        /**\n         * Handle keyboard events while photo preview is visible.\n         */\n        keyNav: null,\n        /**\n         * Respond to user map interaction by hiding photo preview.\n         */\n        mapInteraction: function (e) {\n            if (e !== undefined && e.reason != 'fit') {\n                handle.closePreview();\n            }\n        },\n        /**\n         * Update map size variables when window is resized.\n         */\n        windowResize: function () {\n            var $c = $('canvas');\n            mapSize.width = $c.width();\n            mapSize.height = $c.height();\n        },\n        /**\n         * Copy current URL to clipboard.\n         *\n         * @see https://css-tricks.com/native-browser-copy-clipboard/\n         */\n        copyUrl: function (_e) {\n            var $temp = $('<textarea>')\n                .text(window.location.href)\n                .appendTo(document.body)\n                .hide();\n            var range = document.createRange();\n            try {\n                range.selectNode($temp[0]);\n                var selection = window.getSelection();\n                if (selection !== null) {\n                    selection.removeAllRanges();\n                    selection.addRange(range);\n                }\n            }\n            catch (ex) {\n                console.error(ex);\n            }\n            $temp.remove();\n        },\n        /**\n         * Click on button with `data-link` attribute.\n         */\n        buttonClick: function (_e) {\n            window.location.href = $(this).data('link');\n        },\n        /**\n         * Click on button with `data-link` attribute having `lat`, `lon`\n         * and `zoom` tokens.\n         */\n        mapLink: function (_e) {\n            var lngLat = map.getCenter();\n            var zoom = map.getZoom();\n            // very rough conversion based on trial-and-error\n            var altitude = (1 / Math.pow(2.3, zoom)) * 375000000;\n            window.location.href = $(this)\n                .data('link')\n                .replace('{lat}', lngLat.lat)\n                .replace('{lon}', lngLat.lng)\n                .replace('{zoom}', zoom)\n                .replace('{altitude}', altitude);\n        },\n        /**\n         * Respond to mouse click on photo marker.\n         */\n        photoClick: function (e) {\n            var $photo = html.photo(e.features[0]);\n            if ($photo !== null) {\n                html.photoPreview(e, 'single', $photo);\n            }\n        },\n        /**\n         * Attach events to the map to hide preview as soon as there's user\n         * interaction.\n         */\n        previewShown: function () {\n            map.on('move', handle.mapInteraction);\n        },\n        /**\n         * Click to close photo preview.\n         */\n        closePreview: function () {\n            $preview.hide();\n            enableKeyNav(false);\n            map.off('move', handle.mapInteraction);\n        },\n        /**\n         * Click to show or hide photo layer.\n         *\n         * @see https://www.mapbox.com/mapbox-gl-js/example/toggle-layers/\n         * @see https://www.mapbox.com/mapbox-gl-js/api/#map#setlayoutproperty\n         */\n        photoLayerToggle: function (_e) {\n            photosVisible = !photosVisible;\n            var p = photosVisible ? 'visible' : 'none';\n            ['cluster', 'cluster-count', 'photo'].forEach(function (l) {\n                map.setLayoutProperty(l, 'visibility', p);\n            });\n            $(this)\n                .find('p')\n                .html((photosVisible ? 'Hide' : 'Show') + ' Photos');\n        },\n        legendToggle: function () {\n            $legendToggle.parents('ul').toggleClass('collapsed');\n            $('nav .toggle-legend').toggleClass('active');\n            legendVisible = !legendVisible;\n            if (!mobileLayout()) {\n                util.setting.showMapLegend = legendVisible;\n            }\n        },\n        /**\n         * Respond to mouse click on cluster marker by showing the nearest\n         * photos equal to the cluster count.\n         *\n         * These may not be the same photos represented by the cluster since\n         * the event coordinate is not the cluster center but the click position\n         * and I've not been able to find a function that exactly relates zoom\n         * level to the radius represented by the cluster.\n         *\n         * @see https://github.com/mapbox/mapbox-gl-js/issues/2384\n         */\n        clusterClick: function (e) {\n            var cluster = e.features[0].properties;\n            var atZoom = map.getZoom();\n            var zoomIn = function () {\n                map.easeTo({\n                    center: e.lngLat,\n                    zoom: MAX_ZOOM - atZoom < 2 ? MAX_ZOOM : atZoom + 2\n                });\n            };\n            if (cluster.point_count !== undefined &&\n                cluster.point_count > MAX_IN_CAROUSEL &&\n                atZoom < MAX_ZOOM - 2) {\n                zoomIn();\n            }\n            else {\n                var photos_1 = cluster.point_count === undefined\n                    ? []\n                    : photosNearLocation(e.lngLat, cluster.point_count);\n                if (photos_1.length == 0) {\n                    zoomIn();\n                }\n                else {\n                    var selected_1 = 1;\n                    var $photos_1 = $('<div>').addClass('photo-list');\n                    var $markers_1 = $('<div>').addClass('markers');\n                    var select_1 = function (count) {\n                        selected_1 += count;\n                        if (selected_1 > photos_1.length) {\n                            selected_1 = 1;\n                        }\n                        else if (selected_1 < 1) {\n                            selected_1 = photos_1.length;\n                        }\n                        $('figure', $photos_1).hide();\n                        $('i', $markers_1).removeClass('selected');\n                        $('figure:nth-child(' + selected_1 + ')', $photos_1).show();\n                        $('i:nth-child(' + selected_1 + ')', $markers_1).addClass('selected');\n                        if (!navigatedPhoto) {\n                            navigatedPhoto = true;\n                        }\n                    };\n                    var prev = function () {\n                        select_1(-1);\n                    };\n                    var next = function () {\n                        select_1(1);\n                    };\n                    if (!mobileLayout()) {\n                        enableKeyNav(true, next, prev);\n                    }\n                    for (var i = 0; i < photos_1.length; i++) {\n                        var $p = html.photo(photos_1[i]);\n                        if ($p !== null) {\n                            $photos_1.append($p);\n                        }\n                    }\n                    if (photos_1.length > MAX_IN_CAROUSEL) {\n                        $markers_1.addClass('too-many');\n                        // use the same <i> tag that icons use to simplify CSS\n                        for (var i = 0; i < photos_1.length; i++) {\n                            $markers_1.append($('<i>').html((i + 1).toString()));\n                        }\n                        $markers_1.append('of ' + photos_1.length);\n                    }\n                    else {\n                        for (var i = 0; i < photos_1.length; i++) {\n                            $markers_1.append(util.html.icon('place'));\n                        }\n                    }\n                    $('i:first-child', $markers_1).addClass('selected');\n                    html.photoPreview(e, 'list', $photos_1, $('<nav>')\n                        .append(util.html.icon('arrow_back', prev))\n                        .append($markers_1)\n                        .append($('<div>')\n                        .addClass('mobile-tip')\n                        .html('tap photo to view post'))\n                        .append(util.html.icon('arrow_forward', next)));\n                }\n            }\n        }\n    };\n    if (qs.center) {\n        enableZoomOut();\n    }\n    $legendToggle.click(handle.legendToggle);\n    // legend nav button only visible on mobile\n    $('nav button.toggle-legend').click(handle.legendToggle);\n    $('nav button.map-link').click(handle.mapLink);\n    $('nav button.copy-url').click(handle.copyUrl);\n    $('nav button.toggle-photos').click(handle.photoLayerToggle);\n    window.addEventListener('resize', handle.windowResize);\n    if (legendVisible) {\n        // if set visible but user hid it then toggle off\n        if (!util.setting.showMapLegend) {\n            $legendToggle.click();\n        }\n    }\n    else {\n        // ensure that legend has 'collapsed' class to match its visibility\n        $legendToggle.parents('ul').addClass('collapsed');\n    }\n    map.addControl(nav, 'top-right').on('load', function () {\n        $.getJSON('/geo.json', function (data) {\n            geoJSON = data;\n            if (geoJSON === null) {\n                console.error('Unable to retrieve blog GeoJSON');\n                return;\n            }\n            $count.find('div').html(geoJSON.features.length.toString());\n            addBaseLayers();\n            addMapHandlers();\n            addMoscowMountainLayers();\n            // set initial map dimensions\n            handle.windowResize();\n            // can't add post layers until base layers are ready\n            if (post) {\n                // Expand bounds so pictures aren't right at the edge. This should\n                // probably do something smarter like a percent of bounding box.\n                post.bounds.sw[0] -= 0.01;\n                post.bounds.sw[1] -= 0.01;\n                post.bounds.ne[0] += 0.01;\n                post.bounds.ne[1] += 0.01;\n                $.getJSON('/' + post.key + '/geo.json', addPostLayers);\n            }\n            else {\n                showPositionInUrl = true;\n            }\n        });\n    });\n    /**\n     * Preview images may be 320 pixels on a side.\n     */\n    function getPreviewPosition(e) {\n        var x = e.point.x;\n        var y = e.point.y;\n        if (mobileLayout(767)) {\n            return {\n                top: (mapSize.height - previewSize.height) / 2,\n                right: 0\n            };\n        }\n        else {\n            var offset = {\n                x: x + previewSize.width - mapSize.width,\n                y: y + previewSize.height - mapSize.height\n            };\n            offset.x = offset.x < 0 ? 0 : offset.x + 10;\n            offset.y = offset.y < 0 ? 0 : offset.y + 10;\n            x -= offset.x;\n            y -= offset.y;\n            if (offset.x + offset.y > 0) {\n                map.panBy([offset.x, offset.y], { duration: 100 }, {\n                    lngLat: e.lngLat,\n                    type: '',\n                    point: e.point,\n                    originalEvent: e.originalEvent,\n                    reason: 'fit',\n                    target: e.target\n                }\n                // {\n                //    type: null,\n                //    point: null,\n                //    target: null,\n                //    reason: 'fit',\n                //    lngLat: null,\n                //    originalEvent: null\n                // }\n                );\n            }\n            return { top: y + 15, left: x + 50 };\n        }\n    }\n    /**\n     * Load map location from URL.\n     */\n    function parseUrl() {\n        var parts = window.location.search.split(/[&\\?]/g);\n        var qs = {};\n        for (var i = 0; i < parts.length; i++) {\n            var pair = parts[i].split('=');\n            if (pair.length == 2)\n                qs[pair[0]] = parseFloat(pair[1]);\n        }\n        if (qs.lon !== undefined && qs.lat !== undefined) {\n            qs.center = [qs.lon, qs.lat];\n        }\n        return qs;\n    }\n    /**\n     * Enable or disable keyboard photo navigation.\n     */\n    function enableKeyNav(enable, next, prev) {\n        if (enable) {\n            handle.keyNav = function (e) {\n                switch (e.keyCode) {\n                    case 27:\n                        handle.mapInteraction();\n                        break;\n                    case 37:\n                        if (prev !== undefined)\n                            prev();\n                        break;\n                    case 39:\n                        if (next !== undefined)\n                            next();\n                        break;\n                }\n            };\n            document.addEventListener('keydown', handle.keyNav);\n        }\n        else if (handle.keyNav !== null) {\n            document.removeEventListener('keydown', handle.keyNav);\n        }\n    }\n    /**\n     * Get number of photos nearest to a location. This is a hack while Mapbox\n     * clusters are unable to report which photos they contain.\n     */\n    function photosNearLocation(lngLat, count) {\n        var z = map.getZoom();\n        var f = (z * 3) / Math.pow(2, z);\n        var sw = [lngLat.lng - f, lngLat.lat - f];\n        var ne = [lngLat.lng + f, lngLat.lat + f];\n        var photos = geoJSON === null\n            ? []\n            : geoJSON.features\n                .filter(function (f) {\n                var coord = f.geometry.coordinates;\n                return (coord[0] >= sw[0] &&\n                    coord[1] >= sw[1] &&\n                    coord[0] <= ne[0] &&\n                    coord[1] <= ne[1]);\n            })\n                .map(function (f) {\n                ;\n                f.properties.distance = distance(lngLat, f.geometry.coordinates);\n                return f;\n            });\n        photos.sort(function (p1, p2) {\n            var d1 = p1.properties.distance;\n            var d2 = p2.properties.distance;\n            if (d1 === undefined)\n                d1 = 0;\n            if (d2 === undefined)\n                d2 = 0;\n            return d1 - d2;\n        });\n        return photos.slice(0, count);\n    }\n    /**\n     * Straight-line distance between two points.\n     */\n    function distance(lngLat, point) {\n        var x1 = lngLat.lng;\n        var y1 = lngLat.lat;\n        var x2 = point[0];\n        var y2 = point[1];\n        return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n    }\n    /**\n     * Update URL with current zoom level and map center.\n     */\n    function updateUrl() {\n        if (showPositionInUrl) {\n            var lngLat = map.getCenter();\n            var url = slug +\n                '/map?lat=' +\n                lngLat.lat +\n                '&lon=' +\n                lngLat.lng +\n                '&zoom=' +\n                map.getZoom();\n            window.history.replaceState(null, '', url);\n        }\n    }\n    /**\n     * Enable or disable the zoom-out button.\n     */\n    function enableZoomOut() {\n        if (initial.zoom === undefined) {\n            return;\n        }\n        if (map.getZoom() > initial.zoom && !zoomOutEnabled) {\n            zoomOutEnabled = true;\n            $zoomOut\n                .click(function () {\n                map.easeTo(initial);\n            })\n                .removeClass('disabled');\n        }\n        else if (map.getZoom() <= initial.zoom && zoomOutEnabled) {\n            zoomOutEnabled = false;\n            $zoomOut.off('click').addClass('disabled');\n        }\n    }\n    /**\n     * Curry function to update canvas cursor.\n     */\n    var cursor = function (name) {\n        if (name === void 0) { name = ''; }\n        return function () {\n            canvas.style.cursor = name;\n        };\n    };\n    /**\n     * Retrieve photo ID from preview URL and redirect to post with that photo.\n     *\n     * Example https://farm3.staticflickr.com/2853/33767184811_9eff6deb48_n.jpg\n     */\n    function showPhotoInPost(url) {\n        var path = url.split('/');\n        var parts = path[path.length - 1].split('_');\n        window.location.href = '/' + parts[0];\n    }\n    /**\n     * Assign source and create layer for post track.\n     *\n     * @see https://www.mapbox.com/mapbox-gl-js/style-spec/#layers-line\n     */\n    function addPostLayers(track) {\n        if (track.features.length > 0) {\n            map.addSource('track', { type: 'geojson', data: track }).addLayer({\n                id: 'track',\n                type: 'line',\n                source: 'track',\n                layout: {\n                    'line-join': 'round',\n                    'line-cap': 'butt'\n                },\n                paint: {\n                    'line-color': '#f22',\n                    'line-width': 5,\n                    'line-opacity': 0.7,\n                    'line-dasharray': [1, 0.8]\n                }\n            }, 'photo');\n            $('#legend .track').removeClass('hidden');\n        }\n        $('nav > button.link').click(handle.buttonClick);\n        // avoid updating URL with automatic reposition\n        map.once('zoomend', function () {\n            window.setTimeout(function () {\n                showPositionInUrl = true;\n            }, 500);\n        });\n        // https://www.mapbox.com/mapbox-gl-js/api/#map#fitbounds\n        map.fitBounds([post.bounds.sw, post.bounds.ne]);\n    }\n    /**\n     * @see https://www.mapbox.com/mapbox-gl-js/example/vector-source/\n     */\n    function addMoscowMountainLayers() {\n        map.addSource('moscow-mountain', {\n            type: 'vector',\n            url: 'mapbox://jabbott7.1q8zrllv'\n        });\n        map.addLayer({\n            id: 'mountain-labels',\n            type: 'symbol',\n            source: 'moscow-mountain',\n            'source-layer': 'moscow-mountain-dvde24',\n            layout: {\n                'text-font': style.font,\n                'text-field': '{name}',\n                'text-size': {\n                    base: 1,\n                    stops: [\n                        [10, 10],\n                        [14, 13]\n                    ]\n                },\n                // \"symbol-placement\": {\n                //    base: 1,\n                //    stops: [[10, \"point\"], [14, \"line\"]]\n                // },\n                'text-rotation-alignment': 'map',\n                'symbol-spacing': 50\n            },\n            paint: {\n                'text-color': '#fff',\n                'text-halo-color': '#000',\n                'text-halo-width': 1,\n                'text-halo-blur': 1\n            },\n            minzoom: 6,\n            maxzoom: 18\n        });\n        map.addLayer({\n            id: 'mountain-tracks',\n            type: 'line',\n            source: 'moscow-mountain',\n            'source-layer': 'moscow-mountain-dvde24',\n            paint: {\n                'line-color': '#55f',\n                'line-width': {\n                    base: 1,\n                    stops: [\n                        [8, 1],\n                        [13, 2]\n                    ]\n                }\n            },\n            minzoom: style.minZoom,\n            maxzoom: style.maxZoom\n        }, 'mountain-labels');\n    }\n    /**\n     * Assign source and define layers for clustering.\n     */\n    function addBaseLayers() {\n        if (geoJSON !== null) {\n            map.addSource('photos', {\n                type: 'geojson',\n                data: geoJSON,\n                cluster: true,\n                clusterMaxZoom: 18,\n                clusterRadius: 30\n            });\n        }\n        // https://www.mapbox.com/mapbox-gl-js/style-spec/#layers-circle\n        // https://www.mapbox.com/mapbox-gl-js/style-spec/#types-function\n        map.addLayer({\n            id: 'cluster',\n            type: 'circle',\n            source: 'photos',\n            filter: ['has', 'point_count'],\n            paint: {\n                'circle-color': '#422',\n                'circle-radius': {\n                    property: 'point_count',\n                    type: 'interval',\n                    stops: [\n                        [0, 10],\n                        [10, 12],\n                        [100, 15]\n                    ]\n                },\n                'circle-opacity': markerOpacity,\n                'circle-stroke-width': 3,\n                'circle-stroke-color': '#ccc'\n            }\n        });\n        // https://www.mapbox.com/mapbox-gl-js/style-spec/#layers-symbol\n        map.addLayer({\n            id: 'cluster-count',\n            type: 'symbol',\n            source: 'photos',\n            filter: ['has', 'point_count'],\n            layout: {\n                'text-field': '{point_count_abbreviated}',\n                'text-font': style.font,\n                'text-size': 14\n            },\n            paint: {\n                'text-color': '#fff'\n            }\n        });\n        // https://www.mapbox.com/mapbox-gl-js/example/custom-marker-icons/\n        map.addLayer({\n            id: 'photo',\n            type: 'circle',\n            source: 'photos',\n            filter: ['!has', 'point_count'],\n            paint: {\n                'circle-color': '#f00',\n                'circle-radius': 7,\n                'circle-stroke-width': 4,\n                'circle-stroke-color': '#fdd',\n                'circle-opacity': markerOpacity\n            }\n        });\n    }\n    /**\n     * @see https://github.com/DefinitelyTyped/DefinitelyTyped/blob/354cec620daccfa0ad167ba046651fb5fef69e8a/types/mapbox-gl/index.d.ts\n     */\n    function addMapHandlers() {\n        map.on('mouseenter', 'cluster', cursor('pointer'))\n            .on('mouseleave', 'cluster', cursor())\n            .on('mouseenter', 'photo', cursor('pointer'))\n            .on('mouseleave', 'photo', cursor())\n            .on('zoomend', handle.zoomEnd)\n            .on('moveend', updateUrl)\n            .on('click', 'cluster', handle.clusterClick)\n            .on('click', 'photo', handle.photoClick);\n    }\n});\n\"use strict\";\n/// <reference types=\"jquery\" />\n/// <reference path=\"../types/mapbox-gl/index.d.ts\" />\n/// <reference path=\"../types/jquery/index.d.ts\"/>\nvar util = {\n    setting: {\n        /**\n         * Save setting to browser storage.\n         *\n         * @see https://developer.mozilla.org/en-US/docs/Web/API/Storage/LocalStorage\n         */\n        save: function (key, value) {\n            if (!window.localStorage)\n                return;\n            localStorage.setItem(key, value);\n        },\n        /**\n         * Load setting from browser storage.\n         */\n        load: function (key) {\n            if (!window.localStorage)\n                return null;\n            return localStorage.getItem(key);\n        },\n        set showMapLegend(value) {\n            util.setting.save('map-legend', value ? 'true' : 'false');\n        },\n        get showMapLegend() {\n            var value = util.setting.load('map-legend');\n            return value ? value == 'true' : true;\n        },\n        /**\n         * Value is array of root and sub-category names.\n         */\n        set menuCategory(selected) {\n            if (typeof selected === 'string') {\n                selected = [selected, null];\n            }\n            if (selected !== null) {\n                util.setting.save('menu', selected.join());\n            }\n        },\n        get menuCategory() {\n            var value = util.setting.load('menu');\n            return value === null ? null : value[1].split(',');\n        },\n    },\n    html: {\n        /**\n         * Generate Google material icon HTML with optional click handler.\n         *\n         * @see https://material.io/icons/\n         */\n        icon: function (name, handler) {\n            var $icon = $('<i>')\n                .addClass('material-icons ' + name)\n                .text(name);\n            if (handler !== undefined)\n                $icon.click(handler);\n            return $icon;\n        },\n    },\n};\n"],"names":["$","mobileLayout","width","window","innerWidth","initial","zoom","center","style","font","minZoom","maxZoom","$count","$preview","$zoomOut","$legendToggle","slug","post","key","qs","parts","location","search","split","i","length","pair","parseFloat","undefined","lon","lat","parseUrl","nav","mapboxgl","NavigationControl","map","Map","container","mapStyle","dragRotate","keyboard","canvas","getCanvasContainer","mapSize","height","previewSize","zoomOutEnabled","legendVisible","photosVisible","showPositionInUrl","geoJSON","html","coordinate","pos","round","n","Math","factor","pow","photo","f","img","properties","url","tip","append","attr","click","path","href","this","geometry","coordinates","photoPreview","e","cssClass","content","navigation","empty","removeClass","css","x","point","y","top","right","offset","panBy","duration","lngLat","type","originalEvent","reason","target","left","getPreviewPosition","addClass","util","icon","handle","closePreview","show","complete","previewShown","zoomEnd","updateUrl","enableZoomOut","keyNav","mapInteraction","windowResize","$c","copyUrl","_e","$temp","text","appendTo","document","body","hide","range","createRange","selectNode","selection","getSelection","removeAllRanges","addRange","ex","console","error","remove","buttonClick","data","mapLink","getCenter","getZoom","altitude","replace","lng","photoClick","$photo","features","on","enableKeyNav","off","photoLayerToggle","p","forEach","l","setLayoutProperty","find","legendToggle","parents","toggleClass","setting","showMapLegend","clusterClick","zoomIn","easeTo","atZoom","count","z","sw","ne","photos","cluster","point_count","MAX_ZOOM","photos_1","filter","coord","x1","y1","x2","y2","distance","sqrt","sort","p1","p2","d1","d2","slice","selected_1","$photos_1","$markers_1","select_1","navigatedPhoto","prev","next","$p","toString","enable","keyCode","addEventListener","removeEventListener","history","replaceState","addControl","getJSON","addSource","clusterMaxZoom","clusterRadius","addLayer","id","source","paint","circle-color","circle-radius","property","stops","circle-opacity","circle-stroke-width","circle-stroke-color","layout","text-field","text-font","text-size","text-color","addBaseLayers","cursor","source-layer","base","text-rotation-alignment","symbol-spacing","text-halo-color","text-halo-width","text-halo-blur","minzoom","maxzoom","line-color","line-width","bounds","addPostLayers","name","track","line-join","line-cap","line-opacity","line-dasharray","once","setTimeout","fitBounds","save","value","localStorage","setItem","load","getItem","menuCategory","selected","join","handler","$icon"],"mappings":"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"}